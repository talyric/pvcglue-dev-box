# Used to control the all of the workers that depend on it.
# Allows workers to be started/stopped without needing root, using the web interface
#
#  Example
#    curl http://localhost:2812/pvcglue_dev_box_local_control -d "action=start"
#

check file pvcglue_dev_box_local_worker_control with path /sites/pvcglue_dev_box/local/shared/worker_control
  # this is a "no-op" so that the default monit actions do not execute
  if does not exist then exec "/bin/true" else if succeeded then exec "/bin/true"

check process delayed_job.0
  with pidfile /sites/pvcglue_dev_box/local/shared/pids/delayed_job.0.pid
  start program = "/home/deploy/.rvm/bin/rvm-shell -c 'cd /sites/pvcglue_dev_box/local/current && RAILS_ENV=local /sites/pvcglue_dev_box/local/current/bin/delayed_job start -i 0 --pid-dir=/sites/pvcglue_dev_box/local/shared/pids'" as uid deploy and gid deploy
  stop program = "/home/deploy/.rvm/bin/rvm-shell -c 'cd /sites/pvcglue_dev_box/local/current && RAILS_ENV=local /sites/pvcglue_dev_box/local/current/bin/delayed_job stop -i 0 --pid-dir=/sites/pvcglue_dev_box/local/shared/pids'" as uid deploy and gid deploy
  group pvcglue_dev_box_local_delayed_job
  group pvcglue_dev_box_local_workers
  depends on pvcglue_dev_box_local_control

check process delayed_job.1
  with pidfile /sites/pvcglue_dev_box/local/shared/pids/delayed_job.1.pid
  start program = "/home/deploy/.rvm/bin/rvm-shell -c 'cd /sites/pvcglue_dev_box/local/current && RAILS_ENV=local /sites/pvcglue_dev_box/local/current/bin/delayed_job start -i 1 --pid-dir=/sites/pvcglue_dev_box/local/shared/pids'" as uid deploy and gid deploy
  stop program = "/home/deploy/.rvm/bin/rvm-shell -c 'cd /sites/pvcglue_dev_box/local/current && RAILS_ENV=local /sites/pvcglue_dev_box/local/current/bin/delayed_job stop -i 1 --pid-dir=/sites/pvcglue_dev_box/local/shared/pids'" as uid deploy and gid deploy
  group pvcglue_dev_box_local_delayed_job
  group pvcglue_dev_box_local_workers
  depends on pvcglue_dev_box_local_control

check process delayed_job.2
  with pidfile /sites/pvcglue_dev_box/local/shared/pids/delayed_job.2.pid
  start program = "/home/deploy/.rvm/bin/rvm-shell -c 'cd /sites/pvcglue_dev_box/local/current && RAILS_ENV=local /sites/pvcglue_dev_box/local/current/bin/delayed_job start -i 2 --pid-dir=/sites/pvcglue_dev_box/local/shared/pids'" as uid deploy and gid deploy
  stop program = "/home/deploy/.rvm/bin/rvm-shell -c 'cd /sites/pvcglue_dev_box/local/current && RAILS_ENV=local /sites/pvcglue_dev_box/local/current/bin/delayed_job stop -i 2 --pid-dir=/sites/pvcglue_dev_box/local/shared/pids'" as uid deploy and gid deploy
  group pvcglue_dev_box_local_delayed_job
  group pvcglue_dev_box_local_workers
  depends on pvcglue_dev_box_local_control

